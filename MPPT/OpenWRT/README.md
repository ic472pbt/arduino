
### OpenWrt Solar Data Sharing Project

This project provides a system for collecting, processing, and sharing solar power and system data from an OpenWrt device. Users have the flexibility to choose between storing data in an SQLite database (using `solar.lua`) or CSV files (using `getstat.py`).

---

### **Features**

1. **Flexible Data Storage**:
   - **SQLite Database**: Use `solar.lua` to store processed data in an SQLite database.
   - **CSV Files**: Use `getstat.py` to save raw data in CSV files for further analysis.

2. **Data Collection**:
   - Collects solar power statistics using a MicroPython script (`getstat.py`) or processes them directly into SQLite with `solar.lua`.

3. **Data Sharing**:
   - The API, written in Lua (`api.lua`), facilitates sharing collected data via HTTP endpoints.
   - The API interacts with the SQLite database if `solar.lua` is used.

4. **OpenWrt Compatibility**:
   - Designed to run on OpenWrt systems, leveraging lightweight scripts and minimal dependencies.

---

### **Project Files**

#### **1. `api.lua`** (Optional)
   - Implements a lightweight HTTP API to expose collected data.
   - Retrieves solar and system statistics from the SQLite database created by `solar.lua`.

#### **2. `collect.sh`**
   - Orchestrates the data collection process:
     - If using `getstat.py`: Runs the MicroPython script to gather solar statistics and save them to CSV files.
     - If using `solar.lua`: Processes solar statistics and pushes them into an SQLite database.
   - for crontab Usage:
     ```bash
     ./collect.sh
     ```

#### **3. `solar.lua`** (Optional)
   - Processes solar data and stores it in an SQLite database for long-term persistence.
   - Handles database creation, updates, and queries.
   - Usage:
     ```bash
     lua solar.lua
     ```

#### **4. `getstat.py`** (Optional)
   - A MicroPython script for collecting raw solar power statistics.
   - Saves the data in CSV files for further processing or analysis.
   - Usage:
     ```bash
     micropython getstat.py
     ```

---

### **Setup Instructions**

#### **Dependencies**
Ensure the following dependencies are installed on your OpenWrt device:
1. **MicroPython** (if using `getstat.py`).
2. **Lua** (if using `solar.lua` or `api.lua`).
3. **SQLite** (if using `solar.lua` for database storage).
4. Additional system utilities (`bash`, `sleep`).

#### **Installation Steps**
1. Clone this repository to your OpenWrt device:
   ```bash
   git clone /path to/ .git
   cd solar-data-sharing
   ```
2. Install SQLite if using `solar.lua`:
   ```bash
   opkg update
   opkg install sqlite3-cli
   ```
3. Make the scripts executable:
   ```bash
   chmod +x collect.sh
   ```
4. Configure the system to run `collect.sh` periodically using `cron` or a similar task scheduler.

---

### **Usage Options**

#### **Option 1: Store Data in SQLite Database**
1. Run the `solar.lua` script manually or via `collect.sh`:
   ```bash
   lua solar.lua
   ```

2. Query the SQLite database directly if needed:
   ```bash
   sqlite3 solar.db
   ```

3. Use the API to access the data:
   ```bash
   curl http://<device-ip>:<port>/solar
   ```

#### **Option 2: Store Data in CSV Files**
1. Run the `getstat.py` script manually or via `collect.sh`:
   ```bash
   micropython getstat.py
   ```

2. Access the CSV files generated by `getstat.py` for further analysis or external processing.

---

### **API Endpoints** (Optional)
The `api.lua` script provides the following endpoints if `solar.lua` is used:
- `/solar`: Retrieves processed solar statistics from the SQLite database.
- Additional endpoints can be added by modifying `api.lua`.

---

### **License**

This project is licensed under the MIT License. See the `LICENSE` file for details.

---

### **Key Notes**
- Use `solar.lua` if you prefer to store and query data in an SQLite database.
- Use `getstat.py` if you prefer storing raw data in CSV files for external analysis.
- Both components are independent and optional, depending on your data storage and sharing needs.